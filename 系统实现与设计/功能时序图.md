# 户外徒步活动管理系统 - 功能时序图

## 图4.3 用户注册时序图

```plantuml
@startuml
actor "用户" as User
actor "前端" as Front
actor "后端" as Backend
actor "数据库" as DB

User -> Front : 点击"注册"按钮
Front -> User : 显示注册表单
User -> Front : 填写注册信息\n(手机号/邮箱/密码)
Front -> Backend : 发送注册请求
Backend -> Backend : 校验数据完整性
Backend -> DB : 查询用户是否存在
DB --> Backend : 返回查询结果
alt 用户不存在
    Backend -> Backend : BCrypt加密密码
    Backend -> DB : 保存用户信息
    DB --> Backend : 返回保存结果
    Backend -> Front : 返回注册成功
else 用户已存在
    Backend -> Front : 返回"用户已存在"
end
Front -> User : 显示注册结果
@enduml
```

---

## 图4.4 活动管理-发布徒步活动时序图

```plantuml
@startuml
actor "组织者" as Organizer
actor "前端" as Front
actor "后端" as Backend
actor "数据库" as DB

Organizer -> Front : 点击"新建活动"按钮
Front -> Organizer : 显示活动编辑页面
Organizer -> Front : 填写活动信息\n(标题/描述/难度/日期/人数/费用)
Organizer -> Front : 上传活动封面图片
Organizer -> Front : 关联徒步路线
Front -> Backend : 提交活动发布请求
Backend -> Backend : 校验数据完整性
Backend -> DB : 查询路线是否存在
DB --> Backend : 返回路线信息
Backend -> Backend : 检查活动参数合法性
Backend -> DB : 保存活动信息\n(状态=待审核)
DB --> Backend : 返回保存结果
Backend -> Front : 返回"提交成功，等待审核"
Front -> Organizer : 显示提交成功提示
@enduml
```

---

## 图4.5 报名管理-提交报名申请时序图

```plantuml
@startuml
actor "参与者" as Participant
actor "前端" as Front
actor "后端" as Backend
actor "数据库" as DB
actor "组织者" as Organizer

Participant -> Front : 点击活动"立即报名"按钮
Front -> Front : 跳转到活动详情页
Participant -> Front : 填写报名信息\n(备注/紧急联系人)
Front -> Backend : 提交报名申请
Backend -> Backend : 校验用户状态
Backend -> Backend : 检查活动状态和报名截止时间
Backend -> DB : 查询报名人数是否已满
DB --> Backend : 返回当前报名人数
alt 报名人数未满且活动可报名
    Backend -> DB : 保存报名信息\n(状态=待审核)
    DB --> Backend : 返回保存结果
    Backend -> Organizer : 发送新报名通知
    Backend -> Front : 返回"提交成功，等待审核"
else 报名人数已满
    Backend -> Front : 返回"活动人数已满"
else 活动报名已截止
    Backend -> Front : 返回"活动报名已截止"
else 用户已报名该活动
    Backend -> Front : 返回"您已报名该活动"
end
Front -> Participant : 显示提交结果
@enduml
```

---

## 图4.6 集合管理-制定集合方案时序图

```plantuml
@startuml
actor "组织者" as Organizer
actor "前端" as Front
actor "后端" as Backend
actor "数据库" as DB
actor "参与者" as Participants

Organizer -> Front : 点击"制定集合方案"按钮
Front -> Organizer : 显示集合方案编辑页面
Organizer -> Front : 填写集合信息\n(时间/地点/交通/物品/注意事项)
Organizer -> Front : 上传集合地点坐标
Front -> Backend : 提交集合方案
Backend -> Backend : 校验数据完整性
Backend -> DB : 保存集合方案\n(状态=已发布)
DB --> Backend : 返回保存结果
Backend -> Participants : 发送集合提醒通知
Backend -> Front : 返回"发布成功"
Front -> Organizer : 显示发布成功提示
@enduml
```

---

## 图4.7 路线管理-规划路线时序图

```plantuml
@startuml
actor "组织者" as Organizer
actor "前端" as Front
actor "后端" as Backend
actor "数据库" as DB
actor "高德地图API" as Amap

Organizer -> Front : 点击"新建路线"按钮
Front -> Organizer : 显示路线编辑页面
Organizer -> Front : 填写路线基本信息\n(名称/描述/难度)
Organizer -> Amap : 在地图上规划路线
Amap --> Front : 返回路线坐标
Organizer -> Front : 添加途经点\n(名称/坐标/海拔)
Organizer -> Front : 添加风险点\n(名称/坐标/类型/提示)
Organizer -> Front : 添加签到点\n(名称/坐标/半径/顺序)
Front -> Backend : 提交路线保存请求
Backend -> Backend : 计算路线参数\n(里程/爬升/下降)
Backend -> DB : 保存路线信息
DB --> Backend : 返回保存结果
Backend -> Front : 返回"保存成功"
Front -> Organizer : 显示保存成功提示
@enduml
```

---

## 图4.8 签到管理-GPS签到时序图

```plantuml
@startuml
actor "参与者" as Participant
actor "前端" as Front
actor "后端" as Backend
actor "数据库" as DB
actor "高德地图API" as Amap

Participant -> Front : 点击"GPS签到"按钮
Front -> Front : 请求GPS定位权限
Participant -> Front : 授权定位
Front -> Amap : 获取用户GPS坐标
Amap --> Front : 返回经纬度坐标
Front -> Backend : 发送签到请求\n(活动ID/签到点ID/坐标)
Backend -> DB : 查询签到点坐标
DB --> Backend : 返回签到点坐标
Backend -> Backend : 计算与签到点距离\n(Haversine公式)
alt 距离 <= 有效半径
    Backend -> DB : 保存签到记录\n(状态=正常)
    DB --> Backend : 返回保存结果
    Backend -> Front : 返回"签到成功"
else 距离 > 有效半径
    Backend -> Front : 返回"不在签到范围内"
end
Front -> Participant : 显示签到结果
@enduml
```

---

## 图4.9 评价反馈-发送活动评价时序图

```plantuml
@startuml
actor "参与者" as Participant
actor "前端" as Front
actor "后端" as Backend
actor "数据库" as DB

Participant -> Front : 点击"写评价"按钮
Front -> Front : 显示评价编辑页面
Participant -> Front : 选择评分等级\n(1-5星)
Participant -> Front : 填写评价内容
Participant -> Front : 上传活动照片(可选)
Front -> Backend : 提交评价请求
Backend -> Backend : 校验用户是否参与该活动
Backend -> Backend : 检查活动是否已结束
alt 用户已参与且活动已结束
    Backend -> DB : 保存评价信息
    DB --> Backend : 返回保存结果
    Backend -> Backend : 计算平均评分
    Backend -> Front : 返回"评价成功"
else 用户未参与
    Backend -> Front : 返回"您未参与该活动，无法评价"
else 活动尚未结束
    Backend -> Front : 返回"活动尚未结束，暂无法评价"
end
Front -> Participant : 显示提交结果
@enduml
```

---

## 图4.10 消息通知-消息推送时序图

```plantuml
@startuml
actor "系统" as System
actor "后端" as Backend
actor "数据库" as DB
actor "用户" as User

System -> Backend : 触发业务事件\n(报名审核通过/集合提醒)
Backend -> Backend : 生成消息内容
Backend -> DB : 保存消息记录\n(状态=未读)
DB --> Backend : 返回保存结果
Backend -> User : 推送站内消息
User -> User : 查看消息列表
User -> Backend : 点击消息详情
Backend -> DB : 更新消息状态为已读
DB --> Backend : 返回更新结果
Backend -> User : 返回"已读"
Front -> User : 显示消息内容
@enduml
```

---

## 时序图使用说明

### PlantUML语法说明

1. **actor**：定义参与者角色
2. **->**：发送请求
3. **-->**：返回响应
4. **alt/else**：条件判断分支
5. **loop**：循环操作
6. **activate/deactivate**：激活/停用参与者的处理时间（可选）

### 图表编号对应关系

- 图4.3：4.2.2功能模块设计 - 用户管理
- 图4.4：4.2.2功能模块设计 - 活动管理
- 图4.5：4.2.2功能模块设计 - 报名管理
- 图4.6：4.2.2功能模块设计 - 集合管理
- 图4.7：4.2.2功能模块设计 - 路线管理
- 图4.8：4.2.2功能模块设计 - 签到管理
- 图4.9：4.2.2功能模块设计 - 评价反馈
- 图4.10：4.2.2功能模块设计 - 消息通知

### 在线PlantUML预览工具

可以使用以下在线工具查看和编辑时序图：
- PlantText：https://www.planttext.com/
- PlantUML Online Server：http://www.plantuml.com/plantuml/uml/

### 导出格式

PlantUML支持以下导出格式：
- PNG图片
- SVG矢量图
- PDF文档

建议在论文中使用PNG或SVG格式的图片，确保清晰度。

